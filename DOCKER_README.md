# Docker –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ STT

–≠—Ç–∞ –≤–µ—Ä—Å–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–µ—Ä —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å GPU –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ, –∞ –∫–ª–∏–µ–Ω—Ç —Å Rich –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º - –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    WebSocket     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Rich –∫–ª–∏–µ–Ω—Ç    ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Docker —Å–µ—Ä–≤–µ—Ä  ‚îÇ
‚îÇ  (–ª–æ–∫–∞–ª—å–Ω–æ)     ‚îÇ                  ‚îÇ  (GPU —Å–µ—Ä–≤–µ—Ä)   ‚îÇ
‚îÇ                 ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ –ú–∏–∫—Ä–æ—Ñ–æ–Ω      ‚îÇ   Audio/Text     ‚îÇ ‚Ä¢ RealtimeSTT   ‚îÇ
‚îÇ ‚Ä¢ Rich UI       ‚îÇ                  ‚îÇ ‚Ä¢ Whisper       ‚îÇ
‚îÇ ‚Ä¢ –ë—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞  ‚îÇ                  ‚îÇ ‚Ä¢ GPU           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ Docker —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å GPU
make docker-up
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç–∞—Ö:
- **8011** - Control WebSocket (–∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- **8012** - Data WebSocket (–∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ –∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è)

### 2. –ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞

**–õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä:**
```bash
make client
```

**–£–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä:**
```bash
make client-server
# –í–≤–µ–¥–∏—Ç–µ IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω–æ
```

## –ö–æ–º–∞–Ω–¥—ã Docker

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make docker-up` | –ó–∞–ø—É—Å–∫ Docker —Å–µ—Ä–≤–µ—Ä–∞ |
| `make docker-down` | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker —Å–µ—Ä–≤–µ—Ä–∞ |
| `make docker-logs` | –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ |
| `make docker-rebuild` | –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ |

## –ö–æ–º–∞–Ω–¥—ã –∫–ª–∏–µ–Ω—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make client` | WebSocket –∫–ª–∏–µ–Ω—Ç –¥–ª—è localhost |
| `make client-server` | –ö–ª–∏–µ–Ω—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ |

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ—Ä–≤–µ—Ä–∞ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ `docker-compose.yml`:

```yaml
command: [
  "python3", "stt_server.py",
  "--model", "small",           # –ú–æ–¥–µ–ª—å: tiny, small, medium, large-v3
  "--language", "ru",           # –Ø–∑—ã–∫: ru, en, auto
  "--realtime_model_type", "tiny", # Real-time –º–æ–¥–µ–ª—å
  "--device", "cuda",           # –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: cuda, cpu
  "--control_port", "8011",     # –ü–æ—Ä—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  "--data_port", "8012"         # –ü–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
]
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏:
- `tiny` - —Å–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è (39M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- `small` - **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** (244M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- `medium` - –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (769M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤) 
- `large-v3` - –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ (1550M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)

## –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–µ—Ä–≤–µ—Ä (Docker):
- **GPU**: NVIDIA —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π CUDA 12.1
- **RAM**: –º–∏–Ω–∏–º—É–º 4GB, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 8GB+
- **Docker**: —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π NVIDIA Container Toolkit
- **–ü–æ—Ä—Ç—ã**: 8011, 8012 –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã

### –ö–ª–∏–µ–Ω—Ç:
- **Python 3.8+**
- **–ú–∏–∫—Ä–æ—Ñ–æ–Ω**
- **RAM**: 1GB
- **–°–µ—Ç—å**: –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ WebSocket

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NVIDIA Container Toolkit

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å GPU:

```bash
# Ubuntu/Debian
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list

sudo apt-get update && sudo apt-get install -y nvidia-docker2
sudo systemctl restart docker

# –ü—Ä–æ–≤–µ—Ä–∫–∞
docker run --rm --gpus all nvidia/cuda:12.1-runtime-ubuntu22.04 nvidia-smi
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ GPU –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –í–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞
docker exec -it realtime-stt-server nvidia-smi
```

### –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:
```bash
make docker-logs
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ NVIDIA toolkit**: `docker run --rm --gpus all nvidia/cuda:12.1-runtime-ubuntu22.04 nvidia-smi`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç—ã**: `netstat -tlnp | grep :801`
3. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏**: `make docker-logs`

### –ö–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è:
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–æ–≤**: `telnet SERVER_IP 8011`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall**: –ø–æ—Ä—Ç—ã 8011, 8012 –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ IP –∞–¥—Ä–µ—Å**: —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP

### –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:
1. **–£–≤–µ–ª–∏—á—å—Ç–µ –º–æ–¥–µ–ª—å**: –∏–∑–º–µ–Ω–∏—Ç–µ `--model small` –Ω–∞ `medium` –∏–ª–∏ `large-v3`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π USB –º–∏–∫—Ä–æ—Ñ–æ–Ω
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å**: –≤—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ

### –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GPU:
1. **–£–º–µ–Ω—å—à–∏—Ç–µ –º–æ–¥–µ–ª—å**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `tiny` –≤–º–µ—Å—Ç–æ `small`
2. **–û—Ç–∫–ª—é—á–∏—Ç–µ real-time**: —É–±–µ—Ä–∏—Ç–µ `--enable_realtime_transcription`
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø–∞–º—è—Ç—å**: –¥–æ–±–∞–≤—å—Ç–µ `--memory=4g` –≤ docker-compose.yml

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞

### Rich –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
- üü° **–ñ–µ–ª—Ç—ã–π —Ç–µ–∫—Å—Ç** - —Ç–µ–∫—É—â–∞—è —Ñ—Ä–∞–∑–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
- üü¢ **–ó–µ–ª–µ–Ω—ã–π/–≥–æ–ª—É–±–æ–π** - –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- üìã **–ê–≤—Ç–æ–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫–∞–∂–¥–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π, —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏:
- **Ctrl+C** - –≤—ã—Ö–æ–¥ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ –±—É—Ñ–µ—Ä

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ù–∞ NVIDIA RTX 3060:
- `small` –º–æ–¥–µ–ª—å: ~100–º—Å –∑–∞–¥–µ—Ä–∂–∫–∞
- `large-v3` –º–æ–¥–µ–ª—å: ~300–º—Å –∑–∞–¥–µ—Ä–∂–∫–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ VRAM: 2-4GB

### –ü–æ —Å–µ—Ç–∏ (1 –ì–±–∏—Ç/—Å):
- –ó–∞–¥–µ—Ä–∂–∫–∞ WebSocket: +10-50–º—Å
- –¢—Ä–∞—Ñ–∏–∫: ~128 –ö–±–∏—Ç/—Å (–∞—É–¥–∏–æ –ø–æ—Ç–æ–∫)

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –ª—é–±—ã—Ö IP –∞–¥—Ä–µ—Å–æ–≤ (`0.0.0.0`). –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–µ—Ä–≤–æ–ª**: –æ–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º 8011-8012
2. **VPN**: –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ VPN
3. **Nginx proxy**: –¥–æ–±–∞–≤—å—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ reverse proxy

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**:
- –ö–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å GPU

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –∏ –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.